{
  "variables": {
    "aws_access_key": "",
    "aws_secret_key": "",
    "user": "packer",
    "pwd": "packer",
    "ssh_timeout": "2000s",
    "iso_name": "ubuntu-16.10-server-amd64",
    "iso_mirror": "http://artifact-repo/iso/",
		"iso_checksum": "7d6de832aee348bacc894f0a2ab1170d",
    "preseed_name": "ubuntu_16.10_de-ch_dhcp.cfg",
    "preseed_mirror": "http://artifact-repo/unattended/",
		"shutdown_command": "sudo systemctl poweroff"
  },
  "builders": [
		{
			"type": "virtualbox-iso",
			"iso_url": "{{user `iso_mirror`}}{{user `iso_name`}}.iso",
			"guest_os_type": "Ubuntu_64",
			"iso_checksum": "{{user `iso_checksum`}}",
			"iso_checksum_type": "md5",
			"ssh_username": "{{user `user`}}",
			"ssh_password": "{{user `pwd`}}", 
			"ssh_timeout": "{{user `ssh_timeout`}}",
			"ssh_pty" : "true",
			"boot_wait": "5s",
			"boot_command": [
				"<esc><wait>",
				"<esc><wait>",
				"<enter><wait>",
				"/install/vmlinuz initrd=/install/initrd.gz ",
				"auto-install/enable=true ",
				"debconf/priority=critical ",
				"preseed/url={{user `preseed_mirror`}}{{user `preseed_name`}} ",
				"<enter>"
			], 
			"shutdown_command": "{{user `shutdown_command`}}",
			"vboxmanage": [
				["modifyvm", "{{.Name}}", "--natdnshostresolver1", "on"]
			]
		}, {
			"type": "qemu",
			"iso_url": "{{user `iso_mirror`}}{{user `iso_name`}}.iso",
			"iso_checksum": "{{user `iso_checksum`}}",
			"iso_checksum_type": "md5",
			"ssh_username": "{{user `user`}}",
			"ssh_password": "{{user `pwd`}}", 
			"ssh_timeout": "{{user `ssh_timeout`}}",
			"ssh_pty" : "true",
			"boot_wait": "5s",
			"boot_command": [
				"<esc><wait>",
				"<esc><wait>",
				"<enter><wait>",
				"/install/vmlinuz initrd=/install/initrd.gz ",
				"auto-install/enable=true ",
				"debconf/priority=critical ",
				"preseed/url={{user `preseed_mirror`}}{{user `preseed_name`}} ",
				"<enter>"
				], 
			"format": "qcow2",
			"headless": false,
			"accelerator": "kvm",
			"net_device": "virtio-net",
			"disk_interface": "virtio",
			"shutdown_command": "{{user `shutdown_command`}}"
		}
  ],
  "provisioners": [
  	{
  		"type": "shell",
			"inline": ["echo 'my additional provisioning steps'"]
  	}
  ],
  "post-processors": [
    {
			"type": "compress",
			"format": "tar.gz",
			"output": "{{user `iso_name`}}-{{.Provider}}.box"
    }
  ]
}
