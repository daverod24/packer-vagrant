{
  "variables": {
    "aws_access_key": "",
    "aws_secret_key": "",
    "user": "packer",
    "pwd": null,
    "ssh_timeout": "2000s",
    "iso_name": "ubuntu-16.10-server-amd64",
    "iso_mirror": "http://releases.ubuntu.com/16.10/",
	"iso_checksum": "7d6de832aee348bacc894f0a2ab1170d",
	"iso_checksum_type": "md5",
	"preseed_name": "ubuntu_16.10_de-ch_dhcp.cfg",
	"preseed_mirror": "http://artifact-repo/unattended/",
	"shutdown_command": "sudo -S shutdown -P now",
	"headless": "true"
  },
  "builders": [
		{
			"type": "virtualbox-iso",
			"iso_url": "{{user `iso_mirror`}}{{user `iso_name`}}.iso",
			"guest_os_type": "Ubuntu_64",
			"headless": "{{user `headless`}}",
			"iso_checksum": "{{user `iso_checksum`}}",
			"iso_checksum_type": "{{user `iso_checksum_type`}}",
			"ssh_username": "{{user `user`}}",
			"ssh_password": "{{user `pwd`}}", 
			"ssh_timeout": "{{user `ssh_timeout`}}",
			"ssh_pty" : "true",
			"boot_wait": "5s",
			"boot_command": [
				"<esc><wait>",
				"<esc><wait>",
				"<enter><wait>",
				"/install/vmlinuz initrd=/install/initrd.gz ",
				"auto-install/enable=true ",
				"debconf/priority=critical ",
				"preseed/file=/floppy/unattended/{{user `preseed_name`}} ",
				"<enter>"
			],
			"floppy_dirs": [
				"../unattended",
				"../scripts"
			], 
			"shutdown_command": "echo '{{user `pwd`}}' | {{user `shutdown_command`}}",
			"vboxmanage": [
				["modifyvm", "{{.Name}}", "--natdnshostresolver1", "on"]
			]
		}, {
			"type": "qemu",
			"headless": "{{user `headless`}}",
			"iso_url": "{{user `iso_mirror`}}{{user `iso_name`}}.iso",
			"iso_checksum": "{{user `iso_checksum`}}",
			"iso_checksum_type": "{{user `iso_checksum_type`}}",
			"ssh_username": "{{user `user`}}",
			"ssh_password": "{{user `pwd`}}", 
			"ssh_timeout": "{{user `ssh_timeout`}}",
			"ssh_pty" : "true",
			"boot_wait": "5s",
			"boot_command": [
				"<esc><wait>",
				"<esc><wait>",
				"<enter><wait>",
				"/install/vmlinuz initrd=/install/initrd.gz ",
				"auto-install/enable=true ",
				"debconf/priority=critical ",
				"preseed/file=/floppy/unattended/{{user `preseed_name`}} ",
				"<enter>"
				], 
			"floppy_dirs": [
				"../unattended",
				"../scripts"
			],
			"format": "qcow2",
			"accelerator": "kvm",
			"net_device": "virtio-net",
			"disk_interface": "virtio",
			"shutdown_command": "echo '{{user `pwd`}}' | {{user `shutdown_command`}}",
			"shutdown_timeout": "1m"
		}
  ],
  "provisioners": [
  	{
  		"type": "shell",
		"inline": [
			"echo 'my additional provisioning steps'"
		]
  	}
  ],
  "post-processors": [
    {
		"type": "vagrant",
		"output": "../boxes/{{user `iso_name`}}/{{user `iso_name`}}-{{.Provider}}.box"
    }
  ]
}
