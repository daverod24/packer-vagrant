task build(type:Exec) {
    println "Task build"
    //executable = "dir"
    //args = [ "packerfiles/iso" ]
    //println "call 'gradle buildWindows -PconfigFile=<config file>' or 'gradle buildLinux -PconfigFile=<config file>'"
    String osName = System.getProperty("os.name").toLowerCase();
    if (!osName.contains("windows")) {
        ext.packer = "packer-io"
    }
}

project.ext {
    packer = 'packer'
}

task buildWindows(dependsOn: "buildWindowsPackages") {
    println "Task buildWindows"
}

task buildWindowsBase(type:Exec) {
    println "Task buildWindowsBase"
    executable = project.ext.packer
    args = ["build", 
        "-var-file=./packerfiles/iso/$configFile", 
        "-var-file=./packerfiles/variables.cfg", 
        "./packerfiles/windows_1_base.json" ]
    commandLine
}

task buildWindowsUpdates(type:Exec, dependsOn: "buildWindowsBase") {
    println "Task buildWindowsUpdates"
    executable = project.ext.packer
    args = ["build", 
        "-var-file=./packerfiles/iso/$configFile", 
        "-var-file=./packerfiles/variables.cfg", 
        "./packerfiles/windows_2_updates.json" ]
    commandLine
}

task buildWindowsPackages(type:Exec, dependsOn: "buildWindowsUpdates") {
    println "Task buildWindowsPackages"
    executable = project.ext.packer
    args = ["build", 
        "-var-file=./packerfiles/iso/$configFile", 
        "-var-file=./packerfiles/variables.cfg", 
        "./packerfiles/windows_3_package.json" ]
    commandLine
}