
plugins {
  id 'org.hidetake.ssh' version '2.8.0'
}

remotes {
    /*def idfile=System.getProperty("user.home") + '/.ssh/id_rsa'
    webServer {
        host = webserver
        user = webserverAdmin
        identity = file(idfile)
    }*/
}

task build(type:Exec) {
    String osName = System.getProperty("os.name").toLowerCase();
    if (osName.contains("windows")) {
        executable = "packer"
    } else {
        executable = "packer-io"
    }

    args = ["build", 
        "-var-file=./packerfiles/iso/windows_server_2016_standard_x64.cfg", 
        "-var-file=./packerfiles/variables.cfg", 
        "./packerfiles/windows_1_base.json" ]
    commandLine
}

task deploy() {
    String osName = System.getProperty("os.name").toLowerCase();
    if (osName.contains("windows")) {
        println "*** deploy on Winodws"
    } else {
        println "*** deploy on Linux"
    }

    /*println "*** Copy answerfiles/preseed files to webserver"
    ssh.run {
        session(remotes.webServer) {
            put from: "$projectDir/unattended/", into: targetDir
        }
    }*/
}